!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("fs")):"function"==typeof define&&define.amd?define(["fs"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).whatsAppClient=t(e.fs)}(this,(function(e){"use strict";function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var s=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,s.get?s:{enumerable:!0,get:function(){return e[a]}})}})),t.default=e,Object.freeze(t)}var a=t(e),s=function(e,t){return function(){for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];return e.apply(t,a)}},n=Object.prototype.toString;function r(e){return"[object Array]"===n.call(e)}function i(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function c(e){if("[object Object]"!==n.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function d(e){return"[object Function]"===n.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),r(e))for(var a=0,s=e.length;a<s;a++)t.call(null,e[a],a,e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}var h={isArray:r,isArrayBuffer:function(e){return"[object ArrayBuffer]"===n.call(e)},isBuffer:function(e){return null!==e&&!i(e)&&null!==e.constructor&&!i(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isPlainObject:c,isUndefined:i,isDate:function(e){return"[object Date]"===n.call(e)},isFile:function(e){return"[object File]"===n.call(e)},isBlob:function(e){return"[object Blob]"===n.call(e)},isFunction:d,isStream:function(e){return o(e)&&d(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function e(){var t={};function a(a,s){c(t[s])&&c(a)?t[s]=e(t[s],a):c(a)?t[s]=e({},a):r(a)?t[s]=a.slice():t[s]=a}for(var s=0,n=arguments.length;s<n;s++)u(arguments[s],a);return t},extend:function(e,t,a){return u(t,(function(t,n){e[n]=a&&"function"==typeof t?s(t,a):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}};function l(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var g=function(e,t,a){if(!t)return e;var s;if(a)s=a(t);else if(h.isURLSearchParams(t))s=t.toString();else{var n=[];h.forEach(t,(function(e,t){null!=e&&(h.isArray(e)?t+="[]":e=[e],h.forEach(e,(function(e){h.isDate(e)?e=e.toISOString():h.isObject(e)&&(e=JSON.stringify(e)),n.push(l(t)+"="+l(e))})))})),s=n.join("&")}if(s){var r=e.indexOf("#");-1!==r&&(e=e.slice(0,r)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e};function p(){this.handlers=[]}p.prototype.use=function(e,t,a){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!a&&a.synchronous,runWhen:a?a.runWhen:null}),this.handlers.length-1},p.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},p.prototype.forEach=function(e){h.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var m=p,f=function(e,t){h.forEach(e,(function(a,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=a,delete e[s])}))},v=function(e,t,a,s,n){return e.config=t,a&&(e.code=a),e.request=s,e.response=n,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e},b=function(e,t,a,s,n){var r=new Error(e);return v(r,t,a,s,n)},y=h.isStandardBrowserEnv()?{write:function(e,t,a,s,n,r){var i=[];i.push(e+"="+encodeURIComponent(t)),h.isNumber(a)&&i.push("expires="+new Date(a).toGMTString()),h.isString(s)&&i.push("path="+s),h.isString(n)&&i.push("domain="+n),!0===r&&i.push("secure"),document.cookie=i.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},I=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],M=h.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function s(e){var s=e;return t&&(a.setAttribute("href",s),s=a.href),a.setAttribute("href",s),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}return e=s(window.location.href),function(t){var a=h.isString(t)?s(t):t;return a.protocol===e.protocol&&a.host===e.host}}():function(){return!0},w=function(e){return new Promise((function(t,a){var s=e.data,n=e.headers,r=e.responseType;h.isFormData(s)&&delete n["Content-Type"];var i=new XMLHttpRequest;if(e.auth){var o=e.auth.username||"",c=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";n.Authorization="Basic "+btoa(o+":"+c)}var d,u,l=(d=e.baseURL,u=e.url,d&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(u)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(d,u):u);function p(){if(i){var s,n,o,c,d,u="getAllResponseHeaders"in i?(s=i.getAllResponseHeaders(),d={},s?(h.forEach(s.split("\n"),(function(e){if(c=e.indexOf(":"),n=h.trim(e.substr(0,c)).toLowerCase(),o=h.trim(e.substr(c+1)),n){if(d[n]&&I.indexOf(n)>=0)return;d[n]="set-cookie"===n?(d[n]?d[n]:[]).concat([o]):d[n]?d[n]+", "+o:o}})),d):d):null,l={data:r&&"text"!==r&&"json"!==r?i.response:i.responseText,status:i.status,statusText:i.statusText,headers:u,config:e,request:i};!function(e,t,a){var s=a.config.validateStatus;a.status&&s&&!s(a.status)?t(b("Request failed with status code "+a.status,a.config,null,a.request,a)):e(a)}(t,a,l),i=null}}if(i.open(e.method.toUpperCase(),g(l,e.params,e.paramsSerializer),!0),i.timeout=e.timeout,"onloadend"in i?i.onloadend=p:i.onreadystatechange=function(){i&&4===i.readyState&&(0!==i.status||i.responseURL&&0===i.responseURL.indexOf("file:"))&&setTimeout(p)},i.onabort=function(){i&&(a(b("Request aborted",e,"ECONNABORTED",i)),i=null)},i.onerror=function(){a(b("Network Error",e,null,i)),i=null},i.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),a(b(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",i)),i=null},h.isStandardBrowserEnv()){var m=(e.withCredentials||M(l))&&e.xsrfCookieName?y.read(e.xsrfCookieName):void 0;m&&(n[e.xsrfHeaderName]=m)}"setRequestHeader"in i&&h.forEach(n,(function(e,t){void 0===s&&"content-type"===t.toLowerCase()?delete n[t]:i.setRequestHeader(t,e)})),h.isUndefined(e.withCredentials)||(i.withCredentials=!!e.withCredentials),r&&"json"!==r&&(i.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&i.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&i.upload&&i.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){i&&(i.abort(),a(e),i=null)})),s||(s=null),i.send(s)}))},P={"Content-Type":"application/x-www-form-urlencoded"};function R(e,t){!h.isUndefined(e)&&h.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var k,S={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(k=w),k),transformRequest:[function(e,t){return f(t,"Accept"),f(t,"Content-Type"),h.isFormData(e)||h.isArrayBuffer(e)||h.isBuffer(e)||h.isStream(e)||h.isFile(e)||h.isBlob(e)?e:h.isArrayBufferView(e)?e.buffer:h.isURLSearchParams(e)?(R(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):h.isObject(e)||t&&"application/json"===t["Content-Type"]?(R(t,"application/json"),JSON.stringify(e)):e}],transformResponse:[function(e){var t=this.transitional,a=t&&t.silentJSONParsing,s=t&&t.forcedJSONParsing,n=!a&&"json"===this.responseType;if(n||s&&h.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw v(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};S.headers={common:{Accept:"application/json, text/plain, */*"}},h.forEach(["delete","get","head"],(function(e){S.headers[e]={}})),h.forEach(["post","put","patch"],(function(e){S.headers[e]=h.merge(P)}));var A=S,C=function(e,t,a){var s=this||A;return h.forEach(a,(function(a){e=a.call(s,e,t)})),e},_=function(e){return!(!e||!e.__CANCEL__)};function T(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var N=function(e){return T(e),e.headers=e.headers||{},e.data=C.call(e,e.data,e.headers,e.transformRequest),e.headers=h.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),h.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||A.adapter)(e).then((function(t){return T(e),t.data=C.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return _(t)||(T(e),t&&t.response&&(t.response.data=C.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},x=function(e,t){t=t||{};var a={},s=["url","method","data"],n=["headers","auth","proxy","params"],r=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],i=["validateStatus"];function o(e,t){return h.isPlainObject(e)&&h.isPlainObject(t)?h.merge(e,t):h.isPlainObject(t)?h.merge({},t):h.isArray(t)?t.slice():t}function c(s){h.isUndefined(t[s])?h.isUndefined(e[s])||(a[s]=o(void 0,e[s])):a[s]=o(e[s],t[s])}h.forEach(s,(function(e){h.isUndefined(t[e])||(a[e]=o(void 0,t[e]))})),h.forEach(n,c),h.forEach(r,(function(s){h.isUndefined(t[s])?h.isUndefined(e[s])||(a[s]=o(void 0,e[s])):a[s]=o(void 0,t[s])})),h.forEach(i,(function(s){s in t?a[s]=o(e[s],t[s]):s in e&&(a[s]=o(void 0,e[s]))}));var d=s.concat(n).concat(r).concat(i),u=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===d.indexOf(e)}));return h.forEach(u,c),a},j="axios",L="0.21.2",U="Promise based HTTP client for the browser and node.js",D="index.js",E={test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},O={type:"git",url:"https://github.com/axios/axios.git"},B=["xhr","http","ajax","promise","node"],F="Matt Zabriskie",q={url:"https://github.com/axios/axios/issues"},$="https://axios-http.com",G={coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},W={"./lib/adapters/http.js":"./lib/adapters/xhr.js"},H="dist/axios.min.js",J="dist/axios.min.js",z="./index.d.ts",V={"follow-redirects":"^1.14.0"},X=[{path:"./dist/axios.min.js",threshold:"5kB"}],K={name:j,version:L,description:U,main:D,scripts:E,repository:O,keywords:B,author:F,license:"MIT",bugs:q,homepage:$,devDependencies:G,browser:W,jsdelivr:H,unpkg:J,typings:z,dependencies:V,bundlesize:X};var Q,Z=(Q=Object.freeze({__proto__:null,name:j,version:L,description:U,main:D,scripts:E,repository:O,keywords:B,author:F,license:"MIT",bugs:q,homepage:$,devDependencies:G,browser:W,jsdelivr:H,unpkg:J,typings:z,dependencies:V,bundlesize:X,default:K}))&&Q.default||Q,Y={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){Y[e]=function(a){return typeof a===e||"a"+(t<1?"n ":" ")+e}}));var ee={},te=Z.version.split(".");function ae(e,t){for(var a=t?t.split("."):te,s=e.split("."),n=0;n<3;n++){if(a[n]>s[n])return!0;if(a[n]<s[n])return!1}return!1}Y.transitional=function(e,t,a){var s=t&&ae(t);function n(e,t){return"[Axios v"+Z.version+"] Transitional option '"+e+"'"+t+(a?". "+a:"")}return function(a,r,i){if(!1===e)throw new Error(n(r," has been removed in "+t));return s&&!ee[r]&&(ee[r]=!0,console.warn(n(r," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(a,r,i)}};var se={isOlderVersion:ae,assertOptions:function(e,t,a){if("object"!=typeof e)throw new TypeError("options must be an object");for(var s=Object.keys(e),n=s.length;n-- >0;){var r=s[n],i=t[r];if(i){var o=e[r],c=void 0===o||i(o,r,e);if(!0!==c)throw new TypeError("option "+r+" must be "+c)}else if(!0!==a)throw Error("Unknown option "+r)}},validators:Y},ne=se.validators;function re(e){this.defaults=e,this.interceptors={request:new m,response:new m}}re.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=x(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&se.assertOptions(t,{silentJSONParsing:ne.transitional(ne.boolean,"1.0.0"),forcedJSONParsing:ne.transitional(ne.boolean,"1.0.0"),clarifyTimeoutError:ne.transitional(ne.boolean,"1.0.0")},!1);var a=[],s=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(s=s&&t.synchronous,a.unshift(t.fulfilled,t.rejected))}));var n,r=[];if(this.interceptors.response.forEach((function(e){r.push(e.fulfilled,e.rejected)})),!s){var i=[N,void 0];for(Array.prototype.unshift.apply(i,a),i.concat(r),n=Promise.resolve(e);i.length;)n=n.then(i.shift(),i.shift());return n}for(var o=e;a.length;){var c=a.shift(),d=a.shift();try{o=c(o)}catch(e){d(e);break}}try{n=N(o)}catch(e){return Promise.reject(e)}for(;r.length;)n=n.then(r.shift(),r.shift());return n},re.prototype.getUri=function(e){return e=x(this.defaults,e),g(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},h.forEach(["delete","get","head","options"],(function(e){re.prototype[e]=function(t,a){return this.request(x(a||{},{method:e,url:t,data:(a||{}).data}))}})),h.forEach(["post","put","patch"],(function(e){re.prototype[e]=function(t,a,s){return this.request(x(s||{},{method:e,url:t,data:a}))}}));var ie=re;function oe(e){this.message=e}oe.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},oe.prototype.__CANCEL__=!0;var ce=oe;function de(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var a=this;e((function(e){a.reason||(a.reason=new ce(e),t(a.reason))}))}de.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},de.source=function(){var e;return{token:new de((function(t){e=t})),cancel:e}};var ue=de;function he(e){var t=new ie(e),a=s(ie.prototype.request,t);return h.extend(a,ie.prototype,t),h.extend(a,t),a}var le=he(A);le.Axios=ie,le.create=function(e){return he(x(le.defaults,e))},le.Cancel=ce,le.CancelToken=ue,le.isCancel=_,le.all=function(e){return Promise.all(e)},le.spread=function(e){return function(t){return e.apply(null,t)}},le.isAxiosError=function(e){return"object"==typeof e&&!0===e.isAxiosError};var ge=le,pe=le;ge.default=pe;var me=ge;class fe{static validateString(e,t){if(!t||"[object String]"!==Object.prototype.toString.call(t))throw new Error(`${e} must be a String!`)}static validateInteger(e,t){if(!Number.isInteger(t))throw new Error(`${e} must be an integer!`)}static validateNumber(e,t){if(!t||!Number(t))throw new Error(`${e} must be a number!`)}static validateObject(e,t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))throw new Error(`${e} must be an Object!`)}static generateMethodURL(e,t,a){return`${e.host}/waInstance${e.idInstance}/${t}/${e.apiTokenInstance}`}static validateChatIdPhoneNumber(e,t){e||fe.validateInteger("phoneNumber",t),t||fe.validateString("chatId",e)}static validateArray(e,t){if(!t||!Array.isArray(t))throw new Error(`${e} must be an Array!`)}static validatePath(e,t){if(!t||!a.existsSync(t))throw new Error(`${e} not found!`)}}class ve{constructor(e){this._restAPI=e}async sendMessage(e,t,a){fe.validateChatIdPhoneNumber(e,t),fe.validateString("message",a);const s={message:a};this.addChadIdParam(s,e),this.addPhoneParam(s,t);return(await me.post(fe.generateMethodURL(this._restAPI.params,"sendMessage"),s)).data}async sendButtons(e,t,a,s){fe.validateChatIdPhoneNumber(e,void 0),fe.validateString("message",t);const n={message:t,footer:a,buttons:s};this.addChadIdParam(n,e);return(await me.post(fe.generateMethodURL(this._restAPI.params,"sendButtons"),n)).data}async sendTemplateButtons(e,t,a,s){fe.validateChatIdPhoneNumber(e,void 0),fe.validateString("message",t);const n={message:t,footer:a,templateButtons:s};this.addChadIdParam(n,e);return(await me.post(fe.generateMethodURL(this._restAPI.params,"sendTemplateButtons"),n)).data}async sendListMessage(e,t,a,s,n,r){fe.validateChatIdPhoneNumber(e,void 0),fe.validateString("message",t);const i={message:t,buttonText:a,title:s,footer:n,sections:r};this.addChadIdParam(i,e);return(await me.post(fe.generateMethodURL(this._restAPI.params,"sendListMessage"),i)).data}async sendLocation(e,t,a,s,n,r){fe.validateChatIdPhoneNumber(e,t),fe.validateString("nameLocation",a),fe.validateString("address",s),fe.validateNumber("latitude",n),fe.validateNumber("longitude",r);const i={nameLocation:a,address:s,latitude:n,longitude:r};this.addChadIdParam(i,e),this.addPhoneParam(i,t);return(await me.post(fe.generateMethodURL(this._restAPI.params,"sendLocation"),i)).data}async sendContact(e,t,a){fe.validateChatIdPhoneNumber(e,t),fe.validateObject("contact",a);const s={contact:a};this.addChadIdParam(s,e),this.addPhoneParam(s,t);return(await me.post(fe.generateMethodURL(this._restAPI.params,"sendContact"),s)).data}async sendLink(e,t,a){fe.validateChatIdPhoneNumber(e,t),fe.validateString("urlLink",a);const s={urlLink:a};this.addChadIdParam(s,e),this.addPhoneParam(s,t);return(await me.post(fe.generateMethodURL(this._restAPI.params,"sendLink"),s)).data}async readChat(e,t,a=null){fe.validateChatIdPhoneNumber(e,t);const s={idMessage:a};this.addChadIdParam(s,e),this.addPhoneParam(s,t);return(await me.post(fe.generateMethodURL(this._restAPI.params,"readChat"),s)).data}async showMessagesQueue(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"showMessagesQueue"))).data.map((e=>new ye(e)))}async clearMessagesQueue(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"clearMessagesQueue"))).data}async lastIncomingMessages(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"lastIncomingMessages"))).data.map((e=>new be(e)))}async lastOutgoingMessages(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"lastOutgoingMessages"))).data.map((e=>new be(e)))}async getChatHistory(e){fe.validateChatIdPhoneNumber(e,void 0);const t={chatId:e};this.addChadIdParam(t,e);return(await me.post(fe.generateMethodURL(this._restAPI.params,"getChatHistory"),t)).data}async forwardMessages(e,t,a){fe.validateString("chatId",e),fe.validateString("chatIdFrom",t),fe.validateArray("messages",a);const s={chatId:e,chatIdFrom:t,messages:a};return(await me.post(fe.generateMethodURL(this._restAPI.params,"ForwardMessages"),s)).data}addChadIdParam(e,t){t&&(e.chatId=t)}addPhoneParam(e,t){t&&(e.chatId=`${t}@c.us`)}}class be{constructor(e){this.chatId=e.chatId,this.idMessage=e.idMessage,this.statusMessage=e.statusMessage,this.textMessage=e.textMessage,this.timestamp=e.timestamp,this.typeMessage=e.typeMessage}}class ye{constructor(e){this.chatId=e.chatId,this.fileName=e.fileName,this.typeMessage=e.typeMessage}}class Ie{constructor(e){this._restAPI=e}async sendFileByUrl(e,t,a,s,n=""){fe.validateChatIdPhoneNumber(e,t),fe.validateString("urlFile",a),fe.validateString("filename",s);const r={urlFile:a,fileName:s,caption:n};this.addChadIdParam(r,e),this.addPhoneParam(r,t);return(await me.post(fe.generateMethodURL(this._restAPI.params,"sendFileByUrl"),r)).data}async sendFileByUpload(e){return(await me({method:"post",url:fe.generateMethodURL(this._restAPI.params,"sendFileByUpload"),data:e,headers:e.getHeaders()})).data}async downloadFile(e,t){fe.validateChatIdPhoneNumber(e,void 0),fe.validateString("message",message);const a={idMessage:t};this.addChadIdParam(a,e);return(await me.post(fe.generateMethodURL(this._restAPI.params,"downloadFile"),a)).data}addChadIdParam(e,t){t&&(e.chatId=t)}addPhoneParam(e,t){t&&(e.phoneNumber=t)}}class Me{constructor(e){this._restAPI=e}async qr(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"qr"))).data}async logout(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"logout"))).data}async reboot(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"reboot"))).data}async getStateInstance(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"getStateInstance"))).data}async getDeviceInfo(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"getDeviceInfo"))).data}async checkWhatsapp(e){fe.validateInteger("phoneNumber",e);const t={phoneNumber:e};return(await me.post(fe.generateMethodURL(this._restAPI.params,"checkWhatsapp"),t)).data}async getAvatar(e,t){fe.validateChatIdPhoneNumber(e,t);const a={};this.addChadIdParam(a,e),this.addPhoneParam(a,t);return(await me.post(fe.generateMethodURL(this._restAPI.params,"getAvatar"),a)).data}async archiveChat(e){fe.validateChatIdPhoneNumber(e,void 0);const t={};this.addChadIdParam(t,e);return(await me.post(fe.generateMethodURL(this._restAPI.params,"archiveChat"),t)).data}async unarchiveChat(e){fe.validateChatIdPhoneNumber(e,void 0);const t={};this.addChadIdParam(t,e);return(await me.post(fe.generateMethodURL(this._restAPI.params,"unarchiveChat"),t)).data}async getContactInfo(e){fe.validateChatIdPhoneNumber(e,void 0);const t={};this.addChadIdParam(t,e);return(await me.post(fe.generateMethodURL(this._restAPI.params,"getContactInfo"),t)).data}async getContacts(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"getContacts"))).data}async getChats(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"getChats"))).data}addChadIdParam(e,t){t&&(e.chatId=t)}addPhoneParam(e,t){t&&(e.phoneNumber=t)}}class we{constructor(e){this._restAPI=e}async getSettings(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"getSettings"))).data}async setSettings(e){fe.validateObject("settings",e);const t=e;return(await me.post(fe.generateMethodURL(this._restAPI.params,"setSettings"),t)).data}}class Pe{constructor(e){this._restAPI=e}async createGroup(e,t,a){fe.validateString("groupName",e),fe.validateArray("chatIds",t),fe.validateArray("phones",a);const s={groupName:e,chatIds:t,phones:a};return(await me.post(fe.generateMethodURL(this._restAPI.params,"createGroup"),s)).data}async addGroupParticipant(e,t,a){fe.validateString("groupId",e),fe.validateChatIdPhoneNumber(t,a);const s={groupId:e,participantChatId:t,participantPhone:a};return(await me.post(fe.generateMethodURL(this._restAPI.params,"addGroupParticipant"),s)).data}async getGroupData(e){fe.validateString("groupId",e);const t={groupId:e};return(await me.post(fe.generateMethodURL(this._restAPI.params,"getGroupData"),t)).data}async removeGroupParticipant(e,t,a){fe.validateString("groupId",e),fe.validateChatIdPhoneNumber(t,a);const s={groupId:e,participantChatId:t,participantPhone:a};return(await me.post(fe.generateMethodURL(this._restAPI.params,"removeGroupParticipant"),s)).data}async updateGroupName(e,t){fe.validateString("groupId",e),fe.validateString("groupName",t);const a={groupId:e,groupName:t};return(await me.post(fe.generateMethodURL(this._restAPI.params,"updateGroupName"),a)).data}async setGroupAdmin(e,t,a){fe.validateString("groupId",e);const s={groupId:e,participantChatId:t,participantPhone:a};return(await me.post(fe.generateMethodURL(this._restAPI.params,"setGroupAdmin"),s)).data}async removeAdmin(e,t,a){fe.validateString("groupId",e);const s={groupId:e,participantChatId:t,participantPhone:a};return(await me.post(fe.generateMethodURL(this._restAPI.params,"removeAdmin"),s)).data}async leaveGroup(e){fe.validateString("groupId",e);const t={groupId:e};return(await me.post(fe.generateMethodURL(this._restAPI.params,"removeAdmin"),t)).data}}class Re{initJobs(e=[]){this.jobs=e}reschedule(){this.jobs.forEach((e=>{e.needInterrupt=!1,clearInterval(e.timerId),e.timerId=setInterval(e.run,1e3*e.intervalSec)}))}unschedule(){this.jobs.forEach((e=>{e.needInterrupt=!0,clearInterval(e.timerId)}))}}class ke{timerId;intervalSec;needInterrupt=!1;constructor(e){this.webhookServiceApi=e,this.intervalSec=Number.parseInt("1")}run=async()=>{clearInterval(this.timerId);try{let e;for(;e=await this.webhookServiceApi.receiveNotification();){let t=e.body;t.typeWebhook===this.webhookServiceApi.noteTypes.incomingMessageReceived?"imageMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageImage,t):"videoMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageVideo,t):"documentMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageDocument,t):"audioMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageAudio,t):"documentMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageDocument,t):"textMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageText,t):"extendedTextMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageTextURL,t):"contactMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageContact,t):"locationMessage"==t.messageData.typeMessage&&this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageLocation,t):t.typeWebhook===this.webhookServiceApi.noteTypes.stateInstanceChanged?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingAccountStatus,t):t.typeWebhook===this.webhookServiceApi.noteTypes.outgoingMessageStatus?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingOutboundMessageStatus,t):t.typeWebhook===this.webhookServiceApi.noteTypes.deviceInfo&&this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingDeviceStatus,t),await this.webhookServiceApi.deleteNotification(e.receiptId)}}catch(e){console.error(e.toString())}this.needInterrupt||(this.timerId=setInterval(this.run,1e3*this.intervalSec))};callCallback(e,t){const a=this.webhookServiceApi._callbacks.get(e);a&&a.call(this,t)}}class Se{constructor(e){this._restAPI=e,this._jobScheduler=new Re,this.noteTypes={incomingMessageReceived:"incomingMessageReceived",outgoingMessageStatus:"outgoingMessageStatus",stateInstanceChanged:"stateInstanceChanged",deviceInfo:"deviceInfo"},this.callbackTypes={onReceivingMessageText:"onReceivingMessageText",onReceivingMessageImage:"onReceivingMessageImage",onReceivingMessageVideo:"onReceivingMessageVideo",onReceivingMessageDocument:"onReceivingMessageDocument",onReceivingMessageAudio:"onReceivingMessageAudio",onReceivingOutboundMessageStatus:"onReceivingOutboundMessageStatus",onReceivingAccountStatus:"onReceivingAccountStatus",onReceivingDeviceStatus:"onReceivingDeviceStatus",onReceivingMessageTextURL:"onReceivingMessageTextURL",onReceivingMessageContact:"onReceivingMessageContact",onReceivingMessageLocation:"onReceivingMessageLocation"},this._callbacks=new Map}async receiveNotification(){return(await me.get(fe.generateMethodURL(this._restAPI.params,"receiveNotification"))).data}async deleteNotification(e){fe.validateInteger("receiptId",e);return(await me.delete(`${fe.generateMethodURL(this._restAPI.params,"deleteNotification")}/${e}`)).data}async startReceivingNotifications(){this._jobScheduler.initJobs([new ke(this)]),this._jobScheduler.reschedule()}async stopReceivingNotifications(){this._jobScheduler.unschedule()}onReceivingMessageText(e){this._callbacks.set(this.callbackTypes.onReceivingMessageText,e)}onReceivingMessageImage(e){this._callbacks.set(this.callbackTypes.onReceivingMessageImage,e)}onReceivingMessageVideo(e){this._callbacks.set(this.callbackTypes.onReceivingMessageVideo,e)}onReceivingMessageDocument(e){this._callbacks.set(this.callbackTypes.onReceivingMessageDocument,e)}onReceivingMessageAudio(e){this._callbacks.set(this.callbackTypes.onReceivingMessageAudio,e)}onReceivingOutboundMessageStatus(e){this._callbacks.set(this.callbackTypes.onReceivingOutboundMessageStatus,e)}onReceivingAccountStatus(e){this._callbacks.set(this.callbackTypes.onReceivingAccountStatus,e)}onReceivingDeviceStatus(e){this._callbacks.set(this.callbackTypes.onReceivingDeviceStatus,e)}onReceivingMessageTextURL(e){this._callbacks.set(this.callbackTypes.onReceivingMessageTextURL,e)}onReceivingMessageContact(e){this._callbacks.set(this.callbackTypes.onReceivingMessageContact,e)}onReceivingMessageLocation(e){this._callbacks.set(this.callbackTypes.onReceivingMessageLocation,e)}}class Ae{constructor(e){this.params={host:"",idInstance:"",apiTokenInstance:"",credentialsPath:null},Object.assign(this.params,e),e.credentialsPath&&a.readFileSync(e.credentialsPath).toString("utf8").split("\n").map((e=>e.split(" ").join(""))).forEach((e=>{e.startsWith("API_TOKEN_INSTANCE=")?this.params.apiTokenInstance=e.replace("API_TOKEN_INSTANCE=","").trim():e.startsWith("ID_INSTANCE=")&&(this.params.idInstance=e.replace("ID_INSTANCE=","").trim())})),this.message=new ve(this),this.file=new Ie(this),this.instance=new Me(this),this.settings=new we(this),this.group=new Pe(this),this.webhookService=new Se(this)}}var Ce="https://api.green-api.com";class _e{constructor(e,t){this._app=e,this._webhookRoutePath=t,this._callbacks=new Map}init(){this._app.post(this._webhookRoutePath,(async(e,t,a)=>{try{console.log(`Received webhook ${e.body.typeWebhook}`);let a=null;a=e.body.messageData&&e.body.messageData.typeMessage?`${e.body.typeWebhook}_${e.body.messageData.typeMessage}`:e.body.typeWebhook;const s=this._callbacks.get(a);return s&&s.call(this,e.body),t.send()}catch(e){a(e)}}))}onStateInstance(e){this._callbacks.set("stateInstanceChanged",e)}onOutgoingMessageStatus(e){this._callbacks.set("outgoingMessageStatus",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.status)}))}onIncomingMessageText(e){this._callbacks.set("incomingMessageReceived_textMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.messageData.textMessageData.textMessage)}))}onIncomingMessageFile(e){this._callbacks.set("incomingMessageReceived_imageMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.messageData.downloadUrl)}))}onIncomingMessageLocation(e){this._callbacks.set("incomingMessageReceived_locationMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.messageData.locationMessageData.latitude,t.messageData.locationMessageData.longitude,t.messageData.locationMessageData.jpegThumbnail)}))}onIncomingMessageContact(e){this._callbacks.set("incomingMessageReceived_contactMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.messageData.contactMessageData.displayName,t.messageData.contactMessageData.vcard)}))}onIncomingMessageExtendedText(e){this._callbacks.set("incomingMessageReceived_extendedTextMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.extendedTextMessageData)}))}onDeviceInfo(e){this._callbacks.set("deviceInfo",e)}}return{restAPI:(e={})=>(function(e={}){e.host?fe.validateString("host",e.host):e.host=Ce,e.credentialsPath?fe.validatePath("credentialsPath",e.credentialsPath):(fe.validateString("idInstance",e.idInstance),fe.validateString("apiTokenInstance",e.apiTokenInstance))}(e),new Ae(e)),webhookAPI:(e,t)=>{const a=new _e(e,t);return a.init(),a}}}));
